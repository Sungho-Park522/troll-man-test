<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>미운 그놈 스탯 분석 결과 - 직장편</title>

    <!-- Chart.js 사용을 위한 CDN 링크 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.7.1/chart.min.js"
        integrity="sha512-QSkVNOCYLtj73J4hbmVoOV6KVZuMluZlioC+trLpewV8qMjsWqlIQvkn1KGX2StWvPMdWGBqim1xlC8krl1EKQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <style>
        /* 로딩 화면 스타일 */
        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            width: 80%;
            max-width: 500px;
            background-color: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            text-align: center;
        }

        .loading-content h2 {
            color: #d9534f;
            margin-bottom: 15px;
            font-size: 28px;
        }

        .loading-text {
            margin-bottom: 20px;
            color: #555;
            font-size: 16px;
        }

        .progress-bar-container {
            width: 100%;
            height: 20px;
            background-color: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-bar {
            height: 100%;
            width: 0;
            background: linear-gradient(90deg, #ff6b6b, #d9534f);
            transition: width 0.3s ease;
            border-radius: 10px;
        }

        .loading-percentage {
            font-weight: bold;
            color: #d9534f;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .loading-messages {
            min-height: 50px;
            margin-bottom: 20px;
        }

        .loading-messages p {
            font-style: italic;
            color: #666;
        }

        /* 광고 컨테이너 스타일 */
        .ad-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            margin: 20px 0;
            overflow: hidden;
            background-color: #f9f9f9;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .ad-header {
            background-color: #f0f0f0;
            padding: 5px 10px;
            text-align: right;
        }

        .ad-header span {
            font-size: 12px;
            color: #777;
        }

        .ad-content {
            padding: 15px;
            text-align: center;
        }

        .ad-content h3 {
            margin-top: 0;
            color: #333;
            font-size: 18px;
        }

        .ad-content p {
            color: #555;
            margin: 5px 0;
        }

        .ad-button {
            display: inline-block;
            background-color: #4a6bdf;
            color: white;
            padding: 8px 20px;
            border-radius: 5px;
            text-decoration: none;
            margin-top: 10px;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        .ad-button:hover {
            background-color: #3a54b4;
        }

        /* 결과 보기 버튼 */
        .show-results-btn {
            background-color: #d9534f;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 5px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin-top: 10px;
        }

        .show-results-btn:hover {
            background-color: #c9302c;
            transform: scale(1.05);
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .pulse {
            animation: pulse 1.5s infinite;
        }

        .difficulty-description {
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
            font-style: italic;
            line-height: 1.5;
        }

        .gauge-label {
            position: absolute;
            top: 50% !important;
            left: 50% !important;
            transform: translate(-50%, -50%) !important;
            font-weight: bold;
            font-size: 16px;
            padding: 2px 10px;
            border-radius: 12px;
            z-index: 20 !important;
            min-width: 120px;
            text-align: center;
            line-height: 26px !important;
            height: 26px !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            margin: 0 !important;
            box-sizing: border-box !important;

            /* 밝은 글자색 설정 */
            color: white !important;
            /* 어두운 배경에서도 글자가 잘 보이도록 텍스트 그림자 추가 */
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8),
                -1px -1px 2px rgba(0, 0, 0, 0.8),
                1px -1px 2px rgba(0, 0, 0, 0.8),
                -1px 1px 2px rgba(0, 0, 0, 0.8) !important;
            /* 폰트 크기 약간 키우기 */
            font-size: 18px !important;
            /* 글자 간격 약간 늘리기 */
            letter-spacing: 0.5px !important;
        }

        /* 생존 난이도 섹션 CSS 추가 */
        .difficulty-description {
            text-align: center;
            margin-top: 15px;
            font-size: 16px;
            font-style: italic;
            line-height: 1.5;
        }

        /* gauge-label 스타일 수정 */
        .gauge-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.7);
            /* color 속성 제거 (JavaScript에서 동적으로 설정) */
        }

        /* 난이도 텍스트에 애니메이션 추가 (선택사항) */
        @keyframes pulseText {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .gauge-label {
            animation: pulseText 2s infinite ease-in-out;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            line-height: 1.6;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }

        .result-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            position: relative;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        /* 보스 타이틀 스타일 */
        .boss-title-container {
            margin-bottom: 25px;
        }

        .boss-title {
            text-align: center;
            font-size: 28px;
            font-weight: bold;
            color: white;
            margin-bottom: 0;
            padding: 15px;
            background-color: #d9534f;
            border-radius: 8px 8px 0 0;
        }

        /* 상사 분석 보고서 스타일 */
        .report-container {
            border: 2px solid #d9534f;
            border-radius: 0 0 8px 8px;
            margin-top: 0;
            padding: 0;
            background-color: #fff;
            margin-bottom: 30px;
        }

        .report-header {
            background-color: #f8d7da;
            padding: 10px 20px;
            border-bottom: 1px solid #d9534f;
        }

        .report-header h3 {
            margin: 0;
            color: #d9534f;
            font-size: 18px;
        }

        .report-body {
            padding: 20px;
        }

        .report-section {
            margin-bottom: 15px;
        }

        .report-section:last-child {
            margin-bottom: 0;
        }

        .report-section p {
            margin: 0 0 12px;
            line-height: 1.7;
        }

        .report-section p:last-child {
            margin-bottom: 0;
        }

        .highlight {
            font-weight: bold;
            color: #d9534f;
            background-color: #f8d7da;
            padding: 0 3px;
        }

        .quote {
            font-style: italic;
            color: #6c757d;
            padding-left: 5px;
            border-left: 3px solid #d9534f;
            margin: 8px 0 8px 15px;
            display: inline-block;
        }

        /* 스탯과 이미지를 포함할 컨테이너 - 가로 배치 */
        .results-main-content {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            gap: 20px;
            margin-bottom: 30px;
            width: 100%;
            overflow: hidden;
        }

        /* 레이더 차트 컨테이너 */
        .stats-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 0;
            min-width: 0;
            max-width: 50%;
        }

        .radar-chart-container {
            width: 100%;
            height: 400px;
            margin: 0 auto;
            padding: 10px;
            position: relative;
            box-sizing: border-box;
        }

        .stats-title {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        /* 상사 이미지 컨테이너 */
        .boss-image-container {
            flex: 1;
            position: relative;
            height: 400px;
            margin-bottom: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-width: 0;
            max-width: 50%;
        }

        .boss-image {
            max-height: 100%;
            max-width: 100%;
            width: 200px;
            height: 250px;
            background-color: rgba(220, 220, 220, 0.3);
            border: 2px dashed #ccc;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 14px;
        }

        .bubble-container {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            pointer-events: none;
        }

        .speech-bubble {
            position: absolute;
            padding: 10px 15px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            font-size: 14px;
            max-width: 130px;
            z-index: 10;
        }

        .speech-bubble:after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            background-color: white;
            transform: rotate(45deg);
            z-index: -1;
            box-shadow: 2px 2px 2px rgba(0, 0, 0, 0.05);
        }

        /* 말풍선 위치 조정 */
        .bubble-top-left {
            top: 10px;
            left: 20px;
        }

        .bubble-top-left:after {
            bottom: -6px;
            left: 20px;
        }

        .bubble-top-right {
            top: 25px;
            right: 20px;
        }

        .bubble-top-right:after {
            bottom: -6px;
            right: 20px;
        }

        .bubble-bottom-left {
            bottom: 15px;
            left: 25px;
        }

        .bubble-bottom-left:after {
            top: -6px;
            left: 20px;
        }

        .bubble-bottom-right {
            bottom: 30px;
            right: 25px;
        }

        .bubble-bottom-right:after {
            top: -6px;
            right: 20px;
        }

        /* 생존 난이도 섹션 */
        .difficulty-container {
            margin: 20px 0 30px 0;
            background-color: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-top: 3px solid #ffc107;
        }

        .section-title {
            text-align: center;
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .difficulty-title {
            font-weight: bold;
            margin-bottom: 10px;
            text-align: center;
            font-size: 18px;
        }

        .difficulty-stars {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }

        .star {
            font-size: 30px;
            color: #ddd;
            margin: 0 5px;
        }

        .star.filled {
            color: #ff9800;
        }

        /* 게이지 여백 추가 */
        .difficulty-gauge {
            height: 30px;
            background-color: #e9ecef;
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0 20px 0;
            /* 위 여백 추가 */
            position: relative;
        }

        .gauge-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #ffc107, #ff5722);
            width: 0%;
            transition: width 1.5s ease-in-out;
            border-radius: 15px;
        }

        .gauge-label {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #333;
            font-weight: bold;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.7);
        }

        /* 당신의 빡침 포인트 섹션 스타일 */
        .anger-points {
            margin-top: 0;
            padding: 20px;
            background-color: #fff0f0;
            /* 연한 붉은색 배경 */
            border-radius: 8px;
            border-top: 3px solid #ff4d4d;
            /* 빨간색 테두리 */
            box-shadow: 0 3px 10px rgba(255, 77, 77, 0.2);
        }

        .anger-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
            color: #e60000;
            /* 진한 빨간색 */
            text-align: center;
        }

        .anger-list {
            padding-left: 25px;
            margin: 0;
        }

        .anger-list li {
            margin-bottom: 15px;
            line-height: 1.5;
            position: relative;
            padding-left: 10px;
        }

        .anger-list li:before {
            content: '🔥';
            /* 불 이모지로 변경 */
            position: absolute;
            left: -25px;
        }

        .anger-list li:last-child {
            margin-bottom: 0;
        }

        /* 심리처방전 섹션 */
        /* 심리 처방전 섹션 스타일 */
        .psychological-prescription {
            margin-top: 0;
            padding: 20px;
            background-color: #f0e6ff;
            /* 보라색 계열의 연한 배경 */
            border-radius: 8px;
            border-top: 3px solid #9370DB;
            /* 중간 톤의 보라색 테두리 */
            box-shadow: 0 3px 10px rgba(147, 112, 219, 0.2);
        }

        .prescription-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
            color: #8A2BE2;
            /* 보라색 계열 */
            text-align: center;
        }

        .prescription-list {
            padding-left: 25px;
            margin: 0;
        }

        .prescription-list li {
            margin-bottom: 15px;
            line-height: 1.5;
            position: relative;
            padding-left: 10px;
        }

        .prescription-list li:before {
            content: '💜';
            position: absolute;
            left: -25px;
            color: #9370DB;
        }

        .prescription-list li:last-child {
            margin-bottom: 0;
        }

        /* 생존 팁 섹션 */
        .survival-tips {
            margin-top: 0;
            padding: 20px;
            background-color: #e8f4f8;
            border-radius: 8px;
            border-top: 3px solid #17a2b8;
        }

        .tips-title {
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 18px;
            color: #17a2b8;
        }

        .tips-list {
            padding-left: 25px;
            margin: 0;
        }

        .tips-list li {
            margin-bottom: 12px;
        }

        .tips-list li:last-child {
            margin-bottom: 0;
        }

        .positive-traits {
            margin-top: 25px;
            padding: 15px;
            background-color: #e8f5e9;
            border-radius: 8px;
            border-left: 3px solid #28a745;
        }

        .positive-title {
            font-weight: bold;
            color: #28a745;
            margin-bottom: 10px;
        }

        /* 공유 섹션 */
        .share-section {
            margin-top: 30px;
            text-align: center;
        }

        .share-title {
            margin-bottom: 15px;
            font-weight: bold;
        }

        .share-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .share-button {
            padding: 10px 20px;
            background-color: #4a6bdf;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }

        .share-button:hover {
            background-color: #3a54b4;
        }

        .back-to-test {
            text-align: center;
            margin-top: 30px;
        }

        .back-button {
            padding: 10px 20px;
            background-color: #6c757d;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .back-button:hover {
            background-color: #5a6268;
        }

        /* 결과 애니메이션 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out forwards;
            opacity: 0;
        }

        .delay-1 {
            animation-delay: 0.2s;
        }

        .delay-2 {
            animation-delay: 0.4s;
        }

        .delay-3 {
            animation-delay: 0.4s;
        }

        .delay-4 {
            animation-delay: 0.8s;
        }

        .delay-5 {
            animation-delay: 1.0s;
        }

        .delay-6 {
            animation-delay: 1.2s;
        }

        /* 반응형 디자인 */
        @media (max-width: 768px) {

            /* 모바일에서는 다시 세로 배치로 전환 */
            .results-main-content {
                flex-direction: column;
            }

            .stats-container,
            .boss-image-container {
                max-width: 100%;
                /* 모바일에서는 전체 너비 사용 */
            }

            .speech-bubble {
                max-width: 120px;
                font-size: 12px;
                padding: 8px 12px;
            }

            .boss-image {
                width: 150px;
                height: 200px;
            }

            .radar-chart-container {
                height: 350px;
                /* 모바일에서는 더 작게 */
            }

            .boss-image-container {
                height: 300px;
                /* 모바일에서는 더 작게 */
            }
        }
    </style>
</head>

<body>

    <!-- 로딩 화면 컨테이너 -->
    <div id="loading-container" class="loading-container">
        <div class="loading-content">
            <h2>상사 분석 중...</h2>
            <p class="loading-text">당신의 상사를 심층 분석하고 있습니다. 잠시만 기다려주세요.</p>

            <div class="progress-bar-container">
                <div class="progress-bar" id="loading-progress-bar"></div>
            </div>

            <p class="loading-percentage" id="loading-percentage">0%</p>

            <div class="loading-messages">
                <p id="loading-message">상사의 꼰대력을 측정중...</p>
            </div>

            <!-- 광고 컨테이너 -->
            <div class="ad-container">
                <div class="ad-header">
                    <span>추천</span>
                </div>
                <div class="ad-content">
                    <h3>직장인을 위한 멘탈 케어 서비스</h3>
                    <p>일상의 스트레스, 혼자 참지 마세요.</p>
                    <p>상사 때문에 스트레스 받는 직장인을 위한 특별 할인 중!</p>
                    <a href="#" class="ad-button">자세히 보기</a>
                </div>
            </div>

            <!-- 결과 보기 버튼 (처음에는 숨김) -->
            <button id="show-results-btn" class="show-results-btn" style="display: none;">결과 보기</button>
        </div>
    </div>

    <h1>미운 그놈 스탯 분석</h1>
    <div class="subtitle">직장편 - 결과</div>

    <!-- HTML 구조 순서 변경 - result.html의 result-container 내용 -->
    <div class="result-container">
        <!-- 보스 타이틀 -->
        <div class="boss-title-container fade-in">
            <div class="boss-title" id="boss-title">당신의 상사는...</div>
        </div>

        <!-- 스탯 차트와 상사 이미지 (가로 배치) -->
        <div class="results-main-content">
            <div class="stats-container fade-in delay-1">
                <div class="stats-title">미운 능력치 분석</div>
                <div class="radar-chart-container">
                    <canvas id="statChart"></canvas>
                </div>
            </div>

            <div class="boss-image-container fade-in delay-1">
                <div class="boss-image" id="boss-image-placeholder">
                    상사 이미지<br>(투명 이미지로 교체 예정)
                </div>

                <div class="bubble-container">
                    <div class="speech-bubble bubble-top-left fade-in delay-4" id="bubble-1"></div>
                    <div class="speech-bubble bubble-top-right fade-in delay-5" id="bubble-2"></div>
                    <div class="speech-bubble bubble-bottom-left fade-in delay-6" id="bubble-3"></div>
                    <div class="speech-bubble bubble-bottom-right fade-in delay-4" id="bubble-4"></div>
                </div>
            </div>
        </div>

        <!-- 상사 분석 보고서 -->
        <div class="report-container fade-in delay-2">
            <div class="report-header">
                <h3>상사 분석 보고서</h3>
            </div>
            <div class="report-body" id="boss-description">
                <!-- JavaScript에서 내용이 추가됩니다 -->
                상사를 분석 중입니다...
            </div>
        </div>

        <!-- 생존 난이도 섹션 -->
        <div class="difficulty-container fade-in delay-3">
            <div class="section-title">생존 난이도</div>
            <div class="difficulty-stars">
                <span class="star" id="star-1">★</span>
                <span class="star" id="star-2">★</span>
                <span class="star" id="star-3">★</span>
                <span class="star" id="star-4">★</span>
                <span class="star" id="star-5">★</span>
            </div>
            <div class="difficulty-gauge">
                <div class="gauge-fill" id="difficulty-gauge"></div>
                <div class="gauge-label" id="difficulty-label">순조로움 (0%)</div>
            </div>
            <p class="difficulty-description" id="difficulty-description">난이도 분석 중...</p>
        </div>

        <!-- 생존 팁 섹션 -->
        <!-- 심리 처방전 섹션을 당신의 빡침 포인트로 변경 -->
        <div class="anger-points fade-in delay-4">
            <div class="section-title">당신의 빡침 포인트</div>
            <div class="anger-title">이런 상황에서 빡치시죠?</div>
            <ul class="anger-list" id="tips-list">
                <li>로딩 중...</li>
            </ul>
        </div>
        <!-- <div class="psychological-prescription fade-in delay-4">
            <div class="section-title">당신의 빡침 포인트</div>
            <div class="prescription-title">당신을 위한 처방전</div>
            <ul class="prescription-list" id="tips-list">
                <li>로딩 중...</li>
            </ul>
        </div> -->
        <!-- <div class="survival-tips fade-in delay-4">
            <div class="section-title">생존 가이드</div>
            <div class="tips-title">이렇게 대처하세요</div>
            <ul class="tips-list" id="tips-list">
                <li>로딩 중...</li>
            </ul> -->

        <!-- <div class="positive-traits" id="positive-traits">
                <div class="positive-title">그래도 이런 점은 괜찮아요</div>
                <p id="positive-text">로딩 중...</p>
            </div> -->
        <!-- </div> -->

        <!-- 공유 섹션 -->
        <div class="share-section fade-in delay-5">
            <div class="share-title">친구에게 공유하기</div>
            <div class="share-buttons">
                <button class="share-button" id="copy-link-btn">🔗 링크 복사</button>
                <button class="share-button" id="share-btn">📱 공유하기</button>
            </div>
        </div>

        <div class="back-to-test fade-in delay-6">
            <button class="back-button" id="back-btn">테스트 다시 하기</button>
        </div>
    </div>

    <script>
        // 시드 기반 랜덤 함수
        function seededRandom(seed) {
            const x = Math.sin(seed) * 10000;
            return x - Math.floor(x);
        }

        // 시드 기반 배열 항목 선택
        function selectBasedOnSeed(array, seed) {
            const index = Math.floor(seededRandom(seed) * array.length);
            return array[index];
        }

        // URL에서 능력치 결과와 시드 가져오기
        function getStatsFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const stats = {};

            // 시드 값 가져오기
            const seedParam = urlParams.get('seed');
            if (seedParam) {
                window.resultSeed = parseInt(seedParam);
            } else {
                // 시드가 없으면 새로 생성
                window.resultSeed = Date.now();
            }

            // 기존 방식 (개별 파라미터)으로 스탯 가져오기
            Object.keys(statTypes).forEach(stat => {
                const value = parseInt(urlParams.get(stat));
                stats[stat] = isNaN(value) ? 0 : value;
            });

            return stats;
        }
        // 전역 변수로 차트 인스턴스 저장
        let statChartInstance = null;
        let pageInitialized = false; // 중복 초기화 방지 플래그

        // 능력치 정의
        const statTypes = {
            '꼰대력': {
                color: '#8e44ad', description: '과거 방식을 고집하고 변화를 거부하는 정도',
                positive: '경험을 중요시하는 관점도 있어요',
                tips: ['스스로가 꼰대라는걸 인정한다며 꼰대짓을 마음껏 하고 있죠? 진짜 웃는 얼굴로 은근히 돌려깔때는 정강이를 까주고 싶죠.',
                    '"우리 때는 말이야~" 시작할 때마다 한숨이 나오죠. 그 입에서 나오는 모든 조언이 쓰레기통 직행감인건 아는데, 고개 끄덕이기 지치네요. 인생 선배는 개뿔.',
                    '동기들과 꼰대 상사 명언 빙고판 만들어보세요. 상사가 또 그 소리 시작할 때마다 빙고 체크하면 하루가 조금은 재밌어질 거예요. 고통적인 순간을 웃긴 순간으로 바꾸는 기술이죠!']
            },

            '내로남불': {
                color: '#e74c3c', description: '본인에게는 관대하고 타인에게는 엄격한 정도',
                positive: '때로는 자기 관리에 있어서는 유연한 면도 있어요',
                tips: ['본인 지각할 땐 교통체증, 내가 지각하면 시간 관념 부족이라고? 그 이중성에 치가 떨릴 때 있죠. 가끔은 그 모습 녹화해서 들이밀고 싶어요.',
                    '당신의 3분 지각은 세상 죄악인데, 그 양반의 30분 지각은 어쩔 수 없는 상황이랍니다. 진짜 저런 사람들 뇌구조가 궁금해요. 그 뻔뻔함을 배울 수 있다면 인생이 편해질 텐데.',
                    '내로남불 상사의 말도 안 되는 기준들을 몰래 기록해두세요. 퇴사할 때 "깨달음의 책"으로 동료들에게 남겨주는 것도 좋은 선물이 될 거예요. 웃픈 추억팔이지만 통쾌함이 있죠.']
            },

            '갑질지수': {
                color: '#c0392b', description: '권위적 태도로 압박하고 공격하는 정도',
                positive: '때로는 명확한 지시와 책임 소재가 분명한 편이에요',
                tips: ['또 시작된 갑질의 향연! "너랑 나랑 직읍이 같아?" 따위의 말 좀 그만했으면 좋겠어요. 그 작은 권력으로 사람 괴롭히는 모습이 참 한심하죠.',
                    '손가락으로 책상 두드리며 윽박지를 때마다 "저 손가락을 부러뜨리고 싶다"는 생각, 한 번쯤 해봤죠? 당연한 거예요. 갑질러는 언젠가 자기보다 더 쎈 갑을 만나게 되어 있어요. 그때 분명 크게 다칠거에요^^ (여러모로)',
                    '갑질 상사를 향한 분노 에너지를 운동으로 승화시켜보는건 어때요? 골프, 배드민턴, 테니스 등은 의사가 권장하는 스트레스 해소법입니다! 스트레스도 풀리고 살도 빼보자구요. 그놈의 처벌은 언젠가 나타날 더 쎈 갑이 해줄거에요.']
            },

            '책임회피': {
                color: '#f39c12', description: '실패와 문제를 타인에게 전가하는 정도',
                positive: '위기 상황에서 냉정함을 유지하는 편이에요',
                tips: ['또 누군가를 희생양 삼아 자신은 발 빼고 있죠? "내가 언제 그랬어?" 하는 표정으로 모른 척할 때는 정말 이마를 치고 싶어져요.',
                    '성공할 땐 자기 공이고 실패하면 팀원 탓이라는 이 마법 같은 논리. 저런 사람들이 잘 사는 걸 보면 진짜 세상이 공평한지 의심스러워요. 본인도 자신이 한심한 사람이란걸 알까?',
                    '책임 회피 상사의 말은 반드시 녹음하거나 이메일로 남겨두세요. 거짓말을 밥먹듯이 하는 사람들은 확실한 증거와 논리 앞에 무너지게 되어있거든요!']
            },

            '압박관리': {
                color: '#3498db', description: '모든 세부사항을 통제하려 드는 정도',
                positive: '세부사항까지 신경쓰는 꼼꼼함이 있어요',
                tips: ['하루에도 수십 번 "진행상황 어때?" 물어보는 거 정말 짜증나죠? 내쪽을 쳐다보는 느낌만 들어도 숨이 턱턱 막히죠.',
                    '심지어 부하직원들에게 업무를 떠넘겨 놓고 자신은 관리자라며 압박감만 주고 있어요. 하나하나 다 지적할거면 니가 직접하던가! 라는 말이 목구멍까지 차올라요.',
                    '그놈이 원하는 것보다 더 자주, 더 자세히 보고하세요. 질리게 만들어야 포기합니다. 사소한것까지 물어본다 지적하면 평소에 사소한거까지 태클걸고 지적했던 그놈의 말을 인용하여 되받아 치는게 효과적입니다!']
            },

            '워라밸파괴': {
                color: '#d35400', description: '개인 시간을 존중하지 않고 침해하는 정도',
                positive: '업무에 대한 열정과 헌신이 있어요',
                tips: ['한번 회의했다 하면 1~2시간은 기본이고, 퇴근시간이 얼마 안남았을때 "잠시만 볼까?" 라는 말부터 시작된 대화는 남들 다 퇴근하는데도 계속 듣고있어야 돼요.',
                    '그러다 가끔은 "밥먹고와서 마저 이야기하자~"" 라는 콤보로 이어질때면, 속에서 아주 큰 스트레스가 생기고 머리도 지끈거리고 해요. 그사람과 야근하며 둘이 밥먹을 바에야 집에서 물에 밥을 말아먹는게 낫죠.',
                    '이놈을 위해서 항상 변명으로 말할 퇴근후 일정을 생각해두세요! 물어보면 바로바로 단호하게 거절할 수 있도록 말이죠. 그리고 가끔씩 이놈과 야근을 해야할때면 아주 새벽까지 일을 하자고 압박주세요! 질리도록 만들어야 합니다.']
            },

            '이중인격': {
                color: '#9b59b6', description: '상황에 따라 극단적으로 태도가 바뀌는 정도',
                positive: '상황 적응력이 있어요',
                tips: ['회식땐 형님, 회사에선 남남... 그 변덕에 정신이 혼미해질 때가 있죠. 아침엔 칭찬하더니 오후엔 같은 일로 깔아뭉개는 모습에 현타가 오죠.',
                    '어제는 "최고의 아이디어"라더니 오늘은 "말도 안 되는 소리"라고? 그냥 조현병 환자 아니냐고 물어보고 싶을 때 있어요. 회식 때 친한 척하다가 다음날 모른 척하는 거, 진짜 참기 힘들죠.',
                    '그들의 호의적인 말을 믿지마세요! 살갑게 다가와도 "아 네~" 하고 넘겨버리시고, 급발진하며 나를 공격해도 "아 네~" 하고 넘겨버리세요. 미친개는 피하는개 상책입니다!']
            },

            '무능력': {
                color: '#7f8c8d', description: '실무능력과 판단력이 부족한 정도',
                positive: '때로는 팀원들에게 주도권을 주는 편이에요',
                tips: ['중요한 결정을 내려야 할 때마다 "음... 좀 더 검토해볼게"라고 하는 모습에 속으로 "그냥 결정 좀 해줘!"라고 외치게 되죠. 답답함이 극에 달해요.',
                    '실무는 1도 모르면서 높은 자리 차지하고 있는 그 모습, 정말 신기하죠? 어떻게 저기까지 올라갔는지 미스터리예요. 도대체 어떤 처세술이 있길래 저럴수 있나 경이롭기까지 해요.',
                    '하지만 잠시 생각해보면 팀원들과는 더욱 끈끈하지 않나요? 무능한 상사가 있으면 오히려 팀원들끼리 더 끈끈해집니다. "저 분 빼고 우리끼리 해결하자"는 공감대가 형성되거든요. 상사 뒷담을 통한 스트레스 해소는 덤이죠.']
            },

            '합리성': {
                color: '#2ecc71', description: '공정하고 합리적인 사고를 하는 정도',
                positive: '논리적이고 공정한 판단을 내리려고 노력해요',
                tips: ['합리적으로 말하고 행동하는것 같지만 정작 본인의 마음에 들지 않을 때에는 손바닥 뒤집듯이 상황을 뒤집어 버리지 않나요? 그때부터는 나와의 의사소통 시도 자체가 가식적으로 보여지죠.',
                    '하지만 평소에는 얼핏 논리에 맞는 말들을 하며 압박해오기 때문에 상대하기가 가장 까다롭죠. 논리로 이기고나서는 그 사람의 비논리적인 부분까지 지적하고 설득해야하기 때문이에요.',
                    '이런 상사를 다루는 비법은 그들의 무기를 역이용하는 것입니다. 모든 대화를 녹음하거나 기록해두고, 나중에 그들이 비합리적으로 행동할 때 과거의 말을 그대로 인용해보세요. "지난번에 말씀하신 원칙에 따르면..."이라고 시작하면 적어도 잠시는 당황할 겁니다. 작은 승리지만 당신의 정신 건강을 지키는 데 도움이 될 거예요.']
            }
        };

        // URL에서 능력치 결과 가져오기
        function getStatsFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const stats = {};

            // 한글 파라미터 이름을 직접 사용
            Object.keys(statTypes).forEach(stat => {
                const value = parseInt(urlParams.get(stat));
                stats[stat] = isNaN(value) ? 0 : value;
            });

            return stats;
        }

        // 개선된 레이더 차트 생성 함수
        function createRadarChart(stats) {
            const canvas = document.getElementById('statChart');
            const ctx = canvas.getContext('2d');

            // 기존 차트가 있으면 파괴
            if (statChartInstance) {
                statChartInstance.destroy();
                statChartInstance = null;
            }

            // 객체에서 배열로 변환 (합리성 제외하고 정렬)
            const statEntries = Object.entries(stats)
                .filter(([stat]) => stat !== '합리성')
                .sort((a, b) => b[1] - a[1]); // 값이 높은 순으로 정렬

            // 최대값 확인
            const originalValues = statEntries.map(([, value]) => value);
            const maxValue = Math.max(...originalValues, 1); // 0으로 나누는 것 방지

            // 최대값이 80 미만이면 스케일 조정
            const scaleFactor = maxValue < 80 ? (80 / maxValue) : 1;
            console.log("최대값:", maxValue, "스케일 팩터:", scaleFactor);

            // 스케일 조정된 값 (최대 100)
            const scaledValues = originalValues.map(value =>
                Math.min(Math.round(value * scaleFactor), 100)
            );

            console.log("원본 값:", originalValues);
            console.log("스케일 조정된 값:", scaledValues);

            // 데이터 준비
            const statNames = statEntries.map(([stat]) => stat);

            // 각 능력치별 색상 준비
            const backgroundColors = statNames.map(stat => statTypes[stat].color + '40'); // 40 = 25% 투명도
            const borderColors = statNames.map(stat => statTypes[stat].color);

            try {
                // 차트 생성
                statChartInstance = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: statNames,
                        datasets: [{
                            label: '미운 능력치',
                            data: scaledValues, // 스케일 조정된 값 사용
                            backgroundColor: 'rgba(255, 99, 132, 0.3)',
                            borderColor: 'rgba(255, 99, 132, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: borderColors,
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: borderColors
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                angleLines: {
                                    display: true
                                },
                                suggestedMin: 0,
                                // 최대값이 80 미만이면 최대 스케일을 80으로 설정
                                suggestedMax: maxValue < 80 ? 80 : 100,
                                ticks: {
                                    display: false, // 눈금 숫자 제거
                                    stepSize: maxValue < 80 ? 10 : 20,
                                    font: {
                                        size: 12
                                    }
                                },
                                pointLabels: {
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'top',
                                labels: {
                                    font: {
                                        size: 14
                                    }
                                }
                            },
                            tooltip: {
                                enabled: false // 툴팁 제거
                            }
                        }
                    }
                });

                console.log("차트 생성 성공");
            } catch (error) {
                console.error("차트 생성 오류:", error);
                // 차트 생성 실패 시 대체 표시
                const container = document.querySelector('.radar-chart-container');
                container.innerHTML = '<div style="text-align: center; padding: 20px; color: #d9534f;">차트를 표시할 수 없습니다. 브라우저를 새로고침하거나 다른 브라우저로 시도해보세요.</div>';
            }
        }

        // 말풍선 내용 설정
        function setRandomBubbles(topStats) {
            const bubbles = [
                document.getElementById('bubble-1'),
                document.getElementById('bubble-2'),
                document.getElementById('bubble-3'),
                document.getElementById('bubble-4')
            ];

            const bubbleContents = {
                '꼰대력': [
                    '예전에는 이렇게 안했어',
                    '우리 때는 말이야...',
                    '요즘 애들은 너무 나약해',
                    '경험에서 나오는 말이야'
                ],
                '내로남불': [
                    '나는 괜찮지만 너는 안돼',
                    '내가 지각할 땐 이유가 있지',
                    '특별한 사람은 특별한 대우를',
                    '너희들은 기본도 안 되어 있어'
                ],
                '갑질지수': [
                    '그냥 시키는 대로나 해',
                    '내가 누군지 알아?',
                    '이건 명령이야 부탁이 아니라',
                    '논리고 뭐고 그냥 해'
                ],
                '책임회피': [
                    '내가 언제 그랬어?',
                    '그건 네 담당 아니었어?',
                    '난 관여 안 했어',
                    '상부에서 그렇게 하래'
                ],
                '압박관리': [
                    '그건 왜 그렇게 했어?',
                    '한 시간마다 보고해',
                    '이메일은 내가 검토 후 발송',
                    '그 파일 나한테도 공유해'
                ],
                '워라밸파괴': [
                    '지금 어디세요?',
                    '주말인데 잠깐만 와줘',
                    '야근 좀 해야 될 것 같네요',
                    '휴가 중에 이것만 확인해줘'
                ],
                '이중인격': [
                    '내가 그랬나? 기억이 안 나는데',
                    '회식 땐 가족이지만 회사는 회사지',
                    '농담이었잖아~',
                    '그건 그거고 이건 이거야'
                ],
                '무능력': [
                    '이게 뭐지?',
                    '너희가 알아서 해',
                    '뭐가 좋을까?',
                    '일단 위에 물어볼게'
                ],
                '합리성': [
                    '함께 해결해봅시다',
                    '왜 그렇게 생각하는지 설명해주세요',
                    '다양한 의견을 들어보고 싶어요',
                    '데이터를 검토해볼까요?'
                ]
            };

            // 상위 4개 능력치에 대한 말풍선 내용 설정
            for (let i = 0; i < Math.min(topStats.length, bubbles.length); i++) {
                if (!topStats[i] || !topStats[i][0]) continue; // 배열 범위 체크

                const stat = topStats[i][0];
                const contents = bubbleContents[stat];

                if (!contents || contents.length === 0) {
                    bubbles[i].textContent = "..."; // 기본 텍스트 설정
                    continue;
                }

                // 시드 기반 선택 (오류 방지를 위해 예외 처리 추가)
                try {
                    const specificSeed = (window.resultSeed || 12345) + (i * 500) + stat.charCodeAt(0);
                    const index = Math.floor(Math.abs(Math.sin(specificSeed) * 10000) % contents.length);
                    const randomContent = contents[index];

                    bubbles[i].textContent = randomContent;

                    // 스타일 적용 (statTypes가 정의되어 있는지 확인)
                    if (statTypes && statTypes[stat] && statTypes[stat].color) {
                        bubbles[i].style.backgroundColor = statTypes[stat].color + '40';
                        bubbles[i].style.borderColor = statTypes[stat].color;
                        bubbles[i].style.setProperty('--bubble-color', statTypes[stat].color + '40');
                    }
                } catch (error) {
                    console.error(`말풍선 ${i} 설정 오류:`, error);
                    bubbles[i].textContent = "..."; // 오류 시 기본 텍스트
                }
            }
        }

        // 상사 유형에 따른 이미지 표시 함수
        function setBossImage(bossType) {
            const imagePlaceholder = document.getElementById('boss-image-placeholder');

            // 상사 유형별 이미지 경로 설정
            let imagePath = "";

            switch (bossType) {
                case '구시대의 산물 꼰대 보스':
                    imagePath = "images/boss_old_school.png";
                    break;
                case '황제형 내로남불 보스':
                    imagePath = "images/boss_emperor.png";
                    break;
                case '위협형 갑질 보스':
                    imagePath = "images/boss_threatening.png";
                    break;
                case '배후조종형 회피 보스':
                    imagePath = "images/boss_manipulator.png";
                    break;
                case '완벽주의형 감시 보스':
                    imagePath = "images/boss_perfectionist.png";
                    break;
                case '노예 사냥꾼형 보스':
                    imagePath = "images/boss_slave_hunter.png";
                    break;
                case '변덕쟁이형 지뢰 보스':
                    imagePath = "images/boss_moody.png";
                    break;
                case '뒤끝 작렬형 미소 보스':
                    imagePath = "images/boss_fake_smile.png";
                    break;
                case '무능력형 혼돈 보스':
                    imagePath = "images/boss_incompetent.png";
                    break;
                case '복합형 문제 보스':
                    imagePath = "images/boss_complex.png";
                    break;
                case '다방면 불편형 보스':
                    imagePath = "images/boss_uncomfortable.png";
                    break;
                case '소심한 위선형 보스':
                    imagePath = "images/boss_hypocrite.png";
                    break;
                case '그나마 다행인 평범 보스':
                    imagePath = "images/boss_normal.png";
                    break;
                case '단일 약점형 보스':
                    imagePath = "images/boss_single_weakness.png";
                    break;
                case '준수한 스트레스형 보스':
                    imagePath = "images/boss_stressful.png";
                    break;
                case '미약한 스트레스형 보스':
                    imagePath = "images/boss_mild_stress.png";
                    break;
                case '무난한 일상형 보스':
                    imagePath = "images/boss_ordinary.png";
                    break;
                default:
                    imagePath = "images/boss_default.png";
                    break;
            }

            // 이미지가 존재하는지 확인 (선택적)
            const img = new Image();
            img.onload = function () {
                // 이미지가 로드되면 플레이스홀더를 교체
                imagePlaceholder.innerHTML = '';
                imagePlaceholder.style.background = 'none';
                imagePlaceholder.style.border = 'none';
                imagePlaceholder.appendChild(img);
            };

            img.onerror = function () {
                // 이미지 로드 실패 시 기본 이미지나 메시지 표시
                console.error("이미지를 찾을 수 없습니다: " + imagePath);
                imagePlaceholder.innerHTML = '이미지를 찾을 수 없습니다';
            };

            // 이미지 스타일 설정
            img.src = imagePath;
            img.alt = bossType;
            img.style.maxWidth = '100%';
            img.style.maxHeight = '100%';
            img.style.objectFit = 'contain';
        }

        // 상사 유형 분석 개선 함수
        function analyzeBossType(stats) {
            // 상위 3개 능력치 추출
            const topStats = Object.entries(stats)
                .filter(([stat]) => stat !== '합리성') // 합리성은 제외
                .sort((a, b) => b[1] - a[1])
                .slice(0, 3);

            // 상위 능력치 평균값 계산
            const avgTopValue = topStats.reduce((sum, [, value]) => sum + value, 0) / topStats.length;

            // 합리성 점수 가져오기
            const rationalityScore = stats['합리성'] || 0;

            // 최고 점수 및 두 번째 점수 가져오기
            const topStat1 = topStats[0][0];
            const topValue1 = topStats[0][1];
            const topStat2 = topStats.length > 1 ? topStats[1][0] : null;
            const topValue2 = topStats.length > 1 ? topStats[1][1] : 0;

            // 상사 유형 결정
            let bossTitle, difficultyLevel;

            // 대표 능력치가 높은지 확인 (기준을 70점에서 60점으로 낮춤)
            const isHighStat = avgTopValue >= 45;
            // 최고 점수가 특별히 높은 경우 (65점 이상)
            const isVeryHighTopStat = topValue1 >= 55;

            if (isHighStat || isVeryHighTopStat) {
                // 상위 2개 능력치에 따른 상사 유형 결정
                if (topStat1 === '꼰대력' && (topValue1 >= 55) && (topStat2 === '내로남불' || topStat2 === '갑질지수')) {
                    bossTitle = '구시대의 산물 꼰대 보스';
                    difficultyLevel = 4.5;
                }
                else if (topStat1 === '내로남불' && (topValue1 >= 55) && (topStat2 === '꼰대력' || topStat2 === '갑질지수')) {
                    bossTitle = '황제형 내로남불 보스';
                    difficultyLevel = 4.0;
                }
                else if (topStat1 === '갑질지수' && (topValue1 >= 55) && topStat2 === '책임회피') {
                    bossTitle = '위협형 갑질 보스';
                    difficultyLevel = 5.0;
                }
                else if (topStat1 === '책임회피' && (topValue1 >= 55) && (topStat2 === '이중인격' || topStat2 === '공치사')) {
                    bossTitle = '배후조종형 회피 보스';
                    difficultyLevel = 4.0;
                }
                else if (topStat1 === '압박관리' && (topValue1 >= 55) && topStat2 === '워라밸파괴') {
                    bossTitle = '완벽주의형 감시 보스';
                    difficultyLevel = 4.5;
                }
                else if (topStat1 === '워라밸파괴' && (topValue1 >= 55) && (topStat2 === '압박관리' || topStat2 === '갑질지수')) {
                    bossTitle = '노예 사냥꾼형 보스';
                    difficultyLevel = 5.0;
                }
                else if (topStat1 === '이중인격' && (topValue1 >= 55) && topStat2 === '공치사') {
                    bossTitle = '변덕쟁이형 지뢰 보스';
                    difficultyLevel = 3.5;
                }
                // else if (topStat1 === '공치사' && (topValue1 >= 55) && (topStat2 === '이중인격' || topStat2 === '책임회피')) {
                //     bossTitle = '뒤끝 작렬형 미소 보스';
                //     difficultyLevel = 4.0;
                // }
                else if (topStat1 === '무능력' && (topValue1 >= 55)) {
                    bossTitle = '무능력형 혼돈 보스';
                    difficultyLevel = 3.0;
                }
                // 최고 점수가 55점 이상이고 다른 상위 점수들도 높은 경우
                else if (topValue1 >= 55 && topValue2 >= 40) {
                    bossTitle = '복합형 문제 보스';
                    difficultyLevel = 4.0;
                }
                // 최고 점수가 중간 정도이지만 다른 점수들도 비슷하게 중간 정도인 경우
                else if (topValue1 >= 45 && topValue2 >= 35) {
                    bossTitle = '다방면 불편형 보스';
                    difficultyLevel = 3.5;
                }
                else {
                    // 합리성이 높은지 확인
                    if (rationalityScore >= 60) {
                        bossTitle = '그나마 다행인 평범 보스';
                        difficultyLevel = 2.5;
                    } else {
                        bossTitle = '소심한 위선형 보스';
                        difficultyLevel = 3.0;
                    }
                }
            } else {
                // 점수가 모두 낮은 경우
                if (rationalityScore >= 60) {
                    bossTitle = '그나마 다행인 평범 보스';
                    difficultyLevel = 2.5;
                } else if (avgTopValue >= 40) {
                    bossTitle = '미약한 스트레스형 보스';
                    difficultyLevel = 2.0;
                } else {
                    bossTitle = '무난한 일상형 보스';
                    difficultyLevel = 1.5;
                }
            }

            return {
                title: bossTitle,
                difficultyLevel: difficultyLevel,
                topStats: topStats
            };
        }

        // 보스 유형별 상세 설명 표시
        function displayBossDescription(bossType) {
            const descriptionElement = document.getElementById('boss-description');
            let descriptionHTML = '';

            // 보스 유형에 따라 다른 상세 설명 제공
            switch (bossType) {
                case '구시대의 산물 꼰대 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">시대에 뒤떨어진 사고방식을 금과옥조처럼 모시는</span> 진성 꼰대입니다. '예전에는 말이야~'로 시작하는 멘트가 나오면 귀를 꽉 막고 싶은 충동이 들 겁니다.</p>
</div>

<div class="report-section">
    <p>점심 먹으러 가는데도 <span class="quote">"우리 때는 밥 먹을 시간도 없어서 컵라면으로 때웠는데, 요즘 애들은 복 받았지"</span>라며 당신의 정당한 점심시간까지 죄책감으로 물들입니다. 당신이 정시 퇴근하면 <span class="quote">"벌써 퇴근? 나 젊었을 때는 새벽 2시에 퇴근했는데?"</span>라며 눈치를 줍니다. 그럼 지금도 새벽 2시까지 일하시지, 왜 나한테 강요하나요?</p>
</div>

<div class="report-section">
    <p>새로운 업무 방식을 제안하면 <span class="quote">"그래서 우리가 지금까지 해온 방식이 틀렸다는 거야?"</span>라며 방어적 태도로 일관합니다. 혁신은 먼 나라 이야기, 변화를 거부하는 수준이 화석급입니다. 집에서도 가족들에게 똑같은 소리 해대겠죠. 불쌍한 가족들...</p>
</div>
                    `;
                    break;

                case '황제형 내로남불 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">본인에게는 한없이 관대하고 타인에게는 극도로 엄격한</span> 이중 잣대의 달인입니다. 이 사람의 말은 "Do as I say, not as I do"가 모토입니다.</p>
</div>

<div class="report-section">
    <p>상사는 회의에 10분 늦게 들어오면서도 <span class="quote">"미안, 중요한 일이 있어서"</span>라고 가볍게 넘기지만, 당신이 2분만 늦어도 <span class="quote">"시간 개념이 없네!"</span>라며 공개적으로 망신을 줍니다. 본인은 매일 9시 30분에 출근하면서 직원들에게는 8시 50분까지 출근하라고 강요하는 뻔뻔함이 압권입니다.</p>
</div>

<div class="report-section">
    <p>업무 실수를 하면 <span class="quote">"이런 기본적인 것도 확인 안 해?"</span>라고 질책하면서, 정작 본인의 실수는 <span class="quote">"누구나 실수할 수 있지"</span>라며 슬쩍 넘어갑니다. 자기 편한대로 상황을 해석하는 재주가 천재적인 수준이라 반박할 수조차 없습니다.</p>
</div>
                    `;
                    break;

                case '위협형 갑질 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">권력을 쥐고 있다는 이유만으로 갑질을 일상처럼 하는</span> 전형적인 '을'들의 천적입니다. 출근할 때마다 '오늘은 무슨 트집을 잡을까' 걱정하며 속이 뒤틀립니다.</p>
</div>

<div class="report-section">
    <p>중요한 미팅 5분 전에 <span class="quote">"이거 지금 다시 해와, 마음에 안 들어"</span>라고 말하며 당신을 패닉에 빠뜨립니다. 똑같은 보고서를 열 번 뜯어고치게 하면서 뭐가 문제인지는 절대 명확히 말해주지 않습니다. 답답해서 구멍이라도 뚫어버리고 싶은 심정이죠.</p>
</div>

<div class="report-section">
    <p>회식자리에서는 <span class="quote">"너 술 한잔 더 마셔"</span>라며 강요하고, 퇴근 직전에 <span class="quote">"아, 이것 좀 마무리하고 가"</span>라며 대형 프로젝트를 던져줍니다. 정말 짜증나지만 표정 관리하며 웃어야 하는 현실이 더 괴롭습니다.</p>
</div>
                    `;
                    break;

                case '배후조종형 회피 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">실패의 책임은 절대 지지 않고 성공의 공은 다 가져가는</span> 진정한 비겁함의 대가입니다. 이 사람 때문에 당신은 회사에서 인간 방패 역할을 하고 있습니다.</p>
</div>

<div class="report-section">
    <p>프로젝트가 성공하면 <span class="quote">"내가 이 친구를 잘 지도해서..."</span>라며 공을 가로채고, 문제가 생기면 <span class="quote">"이건 네가 담당한 부분 아니었어?"</span>라며 발뺌합니다. 애초에 내가 언제 이거 맡겠다고 했냐고요? 강요해놓고 왜 나한테 책임을 떠넘기는 겁니까?</p>
</div>

<div class="report-section">
    <p>중요한 의사결정은 항상 <span class="quote">"너가 전문가니까 네가 판단해"</span>라며 미루다가, 결과가 좋으면 본인 판단이었다고 우기고 나쁘면 <span class="quote">"내가 그렇게 하라고 했어?"</span>라고 발뺌합니다. 이런 상사에게 보고하느니 차라리 백수가 낫겠다는 생각이 매일 듭니다.</p>
</div>
                    `;
                    break;

                case '완벽주의형 감시 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">불가능한 마감일과 비현실적인 목표로 직원들을 압박하는</span> 스트레스 제조기입니다. 이 사람 때문에 당신의 탈모는 가속화되고 있습니다.</p>
</div>

<div class="report-section">
    <p>금요일 오후 6시에 <span class="quote">"이거 월요일 아침까지 필요한데?"</span>라고 말하며 주말을 완전히 망쳐놓습니다. 당신이 휴가를 쓰려고 하면 <span class="quote">"지금 이 중요한 시기에?"</span>라고 압박하는데, 이 회사에 중요하지 않은 시기가 있기나 한가요? 참으로 황당한 논리입니다.</p>
</div>

<div class="report-section">
    <p>상사의 <span class="quote">"급하게 처리해야 할 일이 있어"</span>라는 말에 심장이 쿵 내려앉습니다. 결국 당신은 밤 11시까지 야근하고, 상사는 벌써 퇴근한 지 오래입니다. 이 회사 언제 때려칠지 매일 고민하지만, 대출이 있어 또 내일도 출근합니다.</p>
</div>
                    `;
                    break;

                case '노예 사냥꾼형 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">개인 시간이라는 개념 자체를 인정하지 않는</span> 워라밸 테러리스트입니다. 이 사람 때문에 당신의 주말과 저녁 시간은 온통 회사 일로 채워집니다.</p>
</div>

<div class="report-section">
    <p>퇴근 직전에 <span class="quote">"아, 이것만 하고 가자"</span>라고 말하며 3시간짜리 작업을 던집니다. 토요일 오전에는 <span class="quote">"잠깐 회사 들러줄 수 있어?"</span>라는 메시지를 보내고, 일요일 저녁에는 <span class="quote">"내일 회의 자료 좀 미리 검토해줘"</span>라며 잠깐의 휴식도 허락하지 않습니다.</p>
</div>

<div class="report-section">
    <p>식사 중이나 화장실에 있을 때도 <span class="quote">"지금 바로 답장 필요해"</span>라며 연락을 퍼붓습니다. 개인 생활이 뭔지, 휴식이 뭔지 모르는 사람이 상사로 있는 한 당신의 인생은 회사의 소모품으로 전락합니다. 퇴사가 답입니다, 진짜로.</p>
</div>
                    `;
                    break;

                case '변덕쟁이형 지뢰 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">상황에 따라 완전히 다른 인격을 보여주는</span> 인격 변환의 대가입니다. 이 사람의 진짜 모습이 뭔지 아무도 모릅니다. 당신 포함해서.</p>
</div>

<div class="report-section">
    <p>윗사람 앞에서는 <span class="quote">"우리 팀원들이 정말 열심히 했어요"</span>라며 칭찬하다가, 돌아서서 팀원들에게는 <span class="quote">"왜 이것밖에 못해?"</span>라며 독설을 퍼붓습니다. 회식자리에서 <span class="quote">"우리는 가족이야!"</span>라고 외치던 사람이 다음날 아침엔 복도에서 마주쳐도 인사도 받지 않습니다.</p>
</div>

<div class="report-section">
    <p>1:1 면담에서는 <span class="quote">"네 의견을 존중해"</span>라고 말하면서, 회의실에서는 당신의 아이디어를 뭉개버립니다. 이 상사의 기분과 상황에 따라 당신의 하루가 천국이 될 수도, 지옥이 될 수도 있습니다. 매일 아침 출근길에 오늘은 어떤 얼굴로 만날지 걱정하는 자신을 발견하게 됩니다.</p>
</div>
                    `;
                    break;

                case '뒤끝 작렬형 미소 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">상황에 따라 완전히 다른 인격을 보여주는</span> 인격 변환의 대가입니다. 이 사람의 진짜 모습이 뭔지 아무도 모릅니다. 당신 포함해서.</p>
</div>

<div class="report-section">
    <p>윗사람 앞에서는 <span class="quote">"우리 팀원들이 정말 열심히 했어요"</span>라며 칭찬하다가, 돌아서서 팀원들에게는 <span class="quote">"왜 이것밖에 못해?"</span>라며 독설을 퍼붓습니다. 회식자리에서 <span class="quote">"우리는 가족이야!"</span>라고 외치던 사람이 다음날 아침엔 복도에서 마주쳐도 인사도 받지 않습니다.</p>
</div>

<div class="report-section">
    <p>1:1 면담에서는 <span class="quote">"네 의견을 존중해"</span>라고 말하면서, 회의실에서는 당신의 아이디어를 뭉개버립니다. 이 상사의 기분과 상황에 따라 당신의 하루가 천국이 될 수도, 지옥이 될 수도 있습니다. 매일 아침 출근길에 오늘은 어떤 얼굴로 만날지 걱정하는 자신을 발견하게 됩니다.</p>
</div>
                    `;
                    break;

                case '무능력형 혼돈 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">기본적인 업무 능력과 판단력이 심각하게 부족한</span> 무능력의 정수입니다. 이런 사람이 어떻게 상사가 됐는지, 회사의 인사 시스템이 의심스럽습니다.</p>
</div>

<div class="report-section">
    <p>간단한 의사결정도 <span class="quote">"음... 그건 좀 더 검토해볼게"</span>라며 끝없이 미루다가 결국 마감 직전에 당신에게 떠넘깁니다. 중요한 미팅에서는 <span class="quote">"이건 우리 김 대리가 더 잘 알아요"</span>라며 당신에게 즉석에서 발표를 시키고, 본인은 자리만 차지합니다.</p>
</div>

<div class="report-section">
    <p>업계 트렌드나 기술에 대해 물어보면 <span class="quote">"그런 건 너희가 더 잘 알잖아"</span>라며 얼버무립니다. 보고서를 검토할 때도 내용은 보지 않고 띄어쓰기나 서식만 지적합니다. 덕분에 당신은 상사의 일까지 떠안게 되어 업무량은 두 배, 월급은 그대로입니다.</p>
</div>
                    `;
                    break;

                case '복합형 문제 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">여러 문제적 특성이 섞여 있는</span> 최악의 보스 칵테일입니다. 모든 나쁜 상사의 특징을 블렌더에 갈아 만든 것 같아, 어떤 대응법도 완벽하게 통하지 않습니다.</p>
</div>

<div class="report-section">
    <p>월요일에는 꼰대처럼 <span class="quote">"우리 때는 이렇게 안 했어"</span>라며 구시대적 잔소리를 늘어놓다가, 화요일에는 갑질 모드로 <span class="quote">"이거 왜 이렇게 했어? 다시 해!"</span>라며 이유도 말 안 하고 다시 시킵니다. 수요일에는 책임회피 모드로 <span class="quote">"이건 네가 알아서 판단했어야지, 내가 언제 그렇게 하라고 했어?"</span>라며 본인 지시를 부정하고, 목요일에는 아침에 칭찬해놓고 오후엔 같은 일로 질책합니다.</p>
</div>

<div class="report-section">
    <p>금요일 퇴근 직전에는 <span class="quote">"아, 이거 주말까지 끝내야 되는데?"</span>라며 폭탄을 투하하고, 주말에는 진도 체크 메시지를 시간 상관없이 보냅니다. 무슨 지뢰밭도 아니고, 매일 어떤 인격이 튀어나올지 모르니 정신 건강을 위해 이직을 진지하게 고려해보세요. 이런 상사 밑에서 10년 일하면 정신과 약 처방받고 있을 겁니다.</p>
</div>
                    `;
                    break;

                case '그나마 다행인 평범 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">완벽하지는 않지만 극단적인 문제는 적은</span> 그저 그런 평범한 상사입니다. 별로 대단하지 않지만 그렇다고 끔찍하지도 않은, 그저 '버틸만한' 수준입니다.</p>
</div>

<div class="report-section">
    <p>가끔 <span class="quote">"요즘 젊은 사람들은..."</span>이라고 시작했다가 눈치를 보고 말을 돌리는 정도의 가벼운 꼰대 기질이 있습니다. 업무 지시가 가끔 모호해서 두 번 물어봐야 할 때도 있고, 급한 일을 던지기도 하지만 적어도 본인도 같이 야근합니다.</p>
</div>

<div class="report-section">
    <p>성과 평가 때 <span class="quote">"좀 더 적극적이었으면..."</span>이라는 애매한 피드백을 주지만, 최소한 당신의 공로를 완전히 무시하거나 가로채지는 않습니다. 당신이 휴가를 써도 겉으로는 "잘 다녀와"라고 말하지만 약간의 눈치를 줘서 아무 생각 없이 편하게 쉬지는 못합니다. 전체적으로 '나쁜 보스'와 '좋은 보스' 사이 어딘가에 위치한, 그냥 견딜 만한 상사입니다.</p>
</div>
                    `;
                    break;

                case '소심한 위선형 보스':
                    descriptionHTML = `
                        <div class="report-section">
    <p>당신의 상사는 <span class="highlight">대놓고 나쁜 짓은 안 하지만 소극적으로 괴롭히는</span> 수동 공격성의 대가입니다. 미소 띤 얼굴로 당신의 영혼을 갉아먹는 특별한 재능을 가진 심리적 흡혈귀입니다.</p>
</div>

<div class="report-section">
    <p><span class="quote">"급한 건 아닌데... 혹시 오늘까지 가능할까요?"</span>라고 말하면서 사실은 당장 필요한 일을 던집니다. 팀 회의에서는 <span class="quote">"○○씨가 준비한 자료인데, 제가 좀 손을 봤습니다"</span>라고 말하며 당신의 완성된 작업물에 의미 없는 수정을 가해 본인 작업처럼 포장합니다.</p>
</div>

<div class="report-section">
    <p>명확한 피드백 대신 <span class="quote">"음... 뭔가 좀 부족한 느낌이에요"</span>라는 모호한 말만 반복해서, 당신은 도대체 뭘 고쳐야 할지 알 수 없어 밤새 스트레스받으며 수정합니다. 그리고 다음날 보면 <span class="quote">"아, 제가 원한 건 이게 아닌데..."</span>라고 또 불만을 표시합니다. 상담사를 만나면 '수동 공격성 장애'를 진단받을 것 같은 이 상사 때문에 당신은 매일 정신적 소모를 겪고 있습니다.</p>
</div>
                    `;
                    break;

                default:
                    // 기본 설명
                    descriptionHTML = `
                        <div class="report-section">
                            <p>당신의 상사는 독특한 유형의 문제적 인물입니다. 여러 부정적 특성이 혼합되어 있어 예측하기 어렵고 대응하기도 쉽지 않습니다.</p>
                        </div>
                        
                        <div class="report-section">
                            <p>팀원들은 매일 그의 기분과 태도를 파악하는 데 많은 에너지를 소비하고 있으며, 이로 인해 업무 효율성과 팀 분위기가 저하되고 있습니다.</p>
                        </div>
                        
                        <div class="report-section">
                            <p>이 테스트에서 드러난 당신 상사의 주요 미운 능력치를 참고하여 적절한 대응 전략을 세우는 것이 중요합니다.</p>
                        </div>
                    `;
            }

            descriptionElement.innerHTML = descriptionHTML;
        }

        // 심리 처방전 생성 함수 (기존 generateSurvivalTips 함수 대체)
        function generateSurvivalTips(topStats) {
            const tipsList = document.getElementById('tips-list');
            tipsList.innerHTML = '';

            // 각 능력치별 공감/위로 메시지
            const empathyMessages = {
                '꼰대력': ['스스로가 꼰대라는걸 인정한다며 꼰대짓을 마음껏 하고 있죠? 진짜 웃는 얼굴로 은근히 돌려깔때는 정강이를 까주고 싶죠.',
                    '"우리 때는 말이야~" 시작할 때마다 한숨이 나오죠. 그 입에서 나오는 모든 조언이 쓰레기통 직행감인건 아는데, 고개 끄덕이기 지치네요. 인생 선배는 개뿔.',
                    '동기들과 꼰대 상사 명언 빙고판 만들어보세요. 상사가 또 그 소리 시작할 때마다 빙고 체크하면 하루가 조금은 재밌어질 거예요. 고통적인 순간을 웃긴 순간으로 바꾸는 기술이죠!'],
                '내로남불': ['본인 지각할 땐 교통체증, 내가 지각하면 시간 관념 부족이라고? 그 이중성에 치가 떨릴 때 있죠. 가끔은 그 모습 녹화해서 들이밀고 싶어요.',
                    '당신의 3분 지각은 세상 죄악인데, 그 양반의 30분 지각은 어쩔 수 없는 상황이랍니다. 진짜 저런 사람들 뇌구조가 궁금해요. 그 뻔뻔함을 배울 수 있다면 인생이 편해질 텐데.',
                    '내로남불 상사의 말도 안 되는 기준들을 몰래 기록해두세요. 퇴사할 때 "깨달음의 책"으로 동료들에게 남겨주는 것도 좋은 선물이 될 거예요. 웃픈 추억팔이지만 통쾌함이 있죠.'],
                '갑질지수': ['또 시작된 갑질의 향연! "너랑 나랑 직급이 같아?" 따위의 말 좀 그만했으면 좋겠어요. 그 작은 권력으로 사람 괴롭히는 모습이 참 한심하죠.',
                    '손가락으로 책상 두드리며 윽박지를 때마다 "저 손가락을 부러뜨리고 싶다"는 생각, 한 번쯤 해봤죠? 당연한 거예요. 갑질러는 언젠가 자기보다 더 쎈 갑을 만나게 되어 있어요. 그때 분명 크게 다칠거에요^^ (여러모로)',
                    '갑질 상사를 향한 분노 에너지를 운동으로 승화시켜보는건 어때요? 골프, 배드민턴, 테니스 등은 의사가 권장하는 스트레스 해소법입니다! 스트레스도 풀리고 살도 빼보자구요. 그놈의 처벌은 언젠가 나타날 더 쎈 갑이 해줄거에요.'],
                '책임회피': ['또 누군가를 희생양 삼아 자신은 발 빼고 있죠? "내가 언제 그랬어?" 하는 표정으로 모른 척할 때는 정말 이마를 치고 싶어져요.',
                    '성공할 땐 자기 공이고 실패하면 팀원 탓이라는 이 마법 같은 논리. 저런 사람들이 잘 사는 걸 보면 진짜 세상이 공평한지 의심스러워요. 본인도 자신이 한심한 사람이란걸 알까?',
                    '책임 회피 상사의 말은 반드시 녹음하거나 이메일로 남겨두세요. 거짓말을 밥먹듯이 하는 사람들은 확실한 증거와 논리 앞에 무너지게 되어있거든요!'],
                '압박관리': ['하루에도 수십 번 "진행상황 어때?" 물어보는 거 정말 짜증나죠? 내쪽을 쳐다보는 느낌만 들어도 숨이 턱턱 막히죠.',
                    '심지어 부하직원들에게 업무를 떠넘겨 놓고 자신은 관리자라며 압박감만 주고 있어요. 하나하나 다 지적할거면 니가 직접하던가! 라는 말이 목구멍까지 차올라요.',
                    '그놈이 원하는 것보다 더 자주, 더 자세히 보고하세요. 질리게 만들어야 포기합니다. 사소한것까지 물어본다 지적하면 평소에 사소한거까지 태클걸고 지적했던 그놈의 말을 인용하여 되받아 치는게 효과적입니다!'],
                '워라밸파괴': ['한번 회의했다 하면 1~2시간은 기본이고, 퇴근시간이 얼마 안남았을때 "잠시만 볼까?" 라는 말부터 시작된 대화는 남들 다 퇴근하는데도 계속 듣고있어야 돼요.',
                    '그러다 가끔은 "밥먹고와서 마저 이야기하자~"" 라는 콤보로 이어질때면, 속에서 아주 큰 스트레스가 생기고 머리도 지끈거리고 해요. 그사람과 야근하며 둘이 밥먹을 바에야 집에서 물에 밥을 말아먹는게 낫죠.',
                    '이놈을 위해서 항상 변명으로 말할 퇴근후 일정을 생각해두세요! 물어보면 바로바로 단호하게 거절할 수 있도록 말이죠. 그리고 가끔씩 이놈과 야근을 해야할때면 아주 새벽까지 일을 하자고 압박주세요! 질리도록 만들어야 합니다.'],
                '이중인격': ['회식땐 형님, 회사에선 남남... 그 변덕에 정신이 혼미해질 때가 있죠. 아침엔 칭찬하더니 오후엔 같은 일로 깔아뭉개는 모습에 현타가 오죠.',
                    '어제는 "최고의 아이디어"라더니 오늘은 "말도 안 되는 소리"라고? 그냥 조현병 환자 아니냐고 물어보고 싶을 때 있어요. 회식 때 친한 척하다가 다음날 모른 척하는 거, 진짜 참기 힘들죠.',
                    '그들의 호의적인 말을 믿지마세요! 살갑게 다가와도 "아 네~" 하고 넘겨버리시고, 급발진하며 나를 공격해도 "아 네~" 하고 넘겨버리세요. 미친개는 피하는개 상책입니다!'],
                '무능력': ['중요한 결정을 내려야 할 때마다 "음... 좀 더 검토해볼게"라고 하는 모습에 속으로 "그냥 결정 좀 해줘!"라고 외치게 되죠. 답답함이 극에 달해요.',
                    '실무는 1도 모르면서 높은 자리 차지하고 있는 그 모습, 정말 신기하죠? 어떻게 저기까지 올라갔는지 미스터리예요. 도대체 어떤 처세술이 있길래 저럴수 있나 경이롭기까지 해요.',
                    '하지만 잠시 생각해보면 팀원들과는 더욱 끈끈하지 않나요? 무능한 상사가 있으면 오히려 팀원들끼리 더 끈끈해집니다. "저 분 빼고 우리끼리 해결하자"는 공감대가 형성되거든요. 상사 뒷담을 통한 스트레스 해소는 덤이죠.'],
                '합리성': ['합리적으로 말하고 행동하는것 같지만 정작 본인의 마음에 들지 않을 때에는 손바닥 뒤집듯이 상황을 뒤집어 버리지 않나요? 그때부터는 나와의 의사소통 시도 자체가 가식적으로 보여지죠.',
                    '하지만 평소에는 얼핏 논리에 맞는 말들을 하며 압박해오기 때문에 상대하기가 가장 까다롭죠. 논리로 이기고나서는 그 사람의 비논리적인 부분까지 지적하고 설득해야하기 때문이에요.',
                    '이런 상사를 다루는 비법은 그들의 무기를 역이용하는 것입니다. 모든 대화를 녹음하거나 기록해두고, 나중에 그들이 비합리적으로 행동할 때 과거의 말을 그대로 인용해보세요. "지난번에 말씀하신 원칙에 따르면..."이라고 시작하면 적어도 잠시는 당황할 겁니다. 작은 승리지만 당신의 정신 건강을 지키는 데 도움이 될 거예요.']
            };

            // 일반적인 공감/위로 메시지
            const generalEmpathy = [
                "힘든 하루를 보냈나요? 퇴근 후 당신이 좋아하는 음식으로 작은 위로를 해보세요. 당신은 충분히 그럴 자격이 있어요.",
                "상사 때문에 스트레스 받는 건 당신 혼자만의 문제가 아니에요. 같은 고민을 하는 동료들과 가끔 속마음을 나누는 것도 좋은 방법이랍니다.",
                "오늘도 상사 때문에 한숨이 나왔나요? 깊게 심호흡하고 '이 또한 지나가리라'를 기억하세요.",
                "직장에서의 어려움이 당신의 가치를 정의하지 않아요. 당신은 그 이상의 멋진 사람이라는 걸 잊지 마세요.",
                "때로는 '그냥 웃자'가 최고의 대처법일 때도 있어요. 어차피 바꿀 수 없는 상황이라면, 유머로 승화시키는 것도 방법이죠."
            ];

            // 상위 3개 능력치에 대한 위로/공감 메시지 추가
            topStats.forEach(([stat], index) => {
                const messages = empathyMessages[stat];
                if (messages && messages.length > 0) {
                    // 시드 기반 선택 (전역 시드 + 인덱스 + 능력치명 기반)
                    const specificSeed = window.resultSeed + (index * 1000) + stat.charCodeAt(0);
                    const message = selectBasedOnSeed(messages, specificSeed);

                    const li = document.createElement('li');
                    li.textContent = message;
                    tipsList.appendChild(li);
                }
            });

            // 메시지가 3개 미만이면 일반적인 공감 메시지 추가 (시드 기반)
            let generalIndex = 0;
            while (tipsList.children.length < 3 && generalEmpathy.length > 0) {
                const specificSeed = window.resultSeed + 9000 + generalIndex;
                const message = selectBasedOnSeed(generalEmpathy, specificSeed);

                const li = document.createElement('li');
                li.textContent = message;
                tipsList.appendChild(li);

                generalIndex++;

                // 중복 방지를 위해 사용된 메시지 제거
                const messageIndex = generalEmpathy.indexOf(message);
                if (messageIndex !== -1) {
                    generalEmpathy.splice(messageIndex, 1);
                }
            }
        }
        // 생존 팁 생성
        // function generateSurvivalTips(topStats) {
        //     const tipsList = document.getElementById('tips-list');
        //     tipsList.innerHTML = '';

        //     // 상위 3개 능력치에 대한 생존 팁 추가
        //     topStats.forEach(([stat]) => {
        //         const tips = statTypes[stat].tips;
        //         if (tips && tips.length > 0) {
        //             // 각 능력치마다 1-2개 팁 선택
        //             const numTips = Math.min(2, tips.length);
        //             for (let i = 0; i < numTips; i++) {
        //                 const tipIndex = Math.floor(Math.random() * tips.length);
        //                 const tip = tips[tipIndex];

        //                 const li = document.createElement('li');
        //                 li.textContent = tip;
        //                 tipsList.appendChild(li);

        //                 // 사용한 팁 제거 (중복 방지)
        //                 tips.splice(tipIndex, 1);
        //             }
        //         }
        //     });

        //     // 팁이 3개 미만이면 일반적인 팁 추가
        //     if (tipsList.children.length < 3) {
        //         const generalTips = [
        //             "동료들과 좋은 관계를 유지하며 서로 도움을 주고받으세요.",
        //             "스트레스 관리와 자기 돌봄을 위한 시간을 반드시 확보하세요.",
        //             "업무 외 시간에는 취미나 운동을 통해 업무 스트레스를 해소하세요.",
        //             "가능하다면 점진적으로 이직을 준비해보는 것도 좋은 전략입니다.",
        //             "자신의 성과와 업적을 꾸준히 기록하고 포트폴리오를 만들어두세요."
        //         ];

        //         while (tipsList.children.length < 3 && generalTips.length > 0) {
        //             const tipIndex = Math.floor(Math.random() * generalTips.length);
        //             const tip = generalTips[tipIndex];

        //             const li = document.createElement('li');
        //             li.textContent = tip;
        //             tipsList.appendChild(li);

        //             generalTips.splice(tipIndex, 1);
        //         }
        //     }
        // }

        // // 긍정적 특성 생성
        // function generatePositiveTraits(stats) {
        //     const positiveText = document.getElementById('positive-text');

        //     // 낮은 점수의 부정적 능력치 찾기
        //     const lowNegativeStats = Object.entries(stats)
        //         .filter(([stat, value]) => stat !== '합리성' && value < 40)
        //         .sort((a, b) => a[1] - b[1])
        //         .slice(0, 2);

        //     // 합리성 점수 확인
        //     const rationalityScore = stats['합리성'] || 0;

        //     let positiveComment = '';

        //     if (lowNegativeStats.length > 0) {
        //         positiveComment += '적어도 당신의 상사는 ';
        //         lowNegativeStats.forEach(([stat, value], index) => {
        //             positiveComment += `<strong>${stat}</strong>이(가) 낮고`;

        //             if (index < lowNegativeStats.length - 1) {
        //                 positiveComment += ', ';
        //             } else {
        //                 positiveComment += ' ';
        //             }
        //         });

        //         const randomPositives = [
        //             '그나마 다행이네요.',
        //             '생각보다 견딜만 할 수도 있어요.',
        //             '최악의 상사는 아닌 것 같네요.',
        //             '그래도 완전 지옥은 아니네요.'
        //         ];

        //         positiveComment += randomPositives[Math.floor(Math.random() * randomPositives.length)];
        //     }

        //     if (rationalityScore > 50) {
        //         if (positiveComment) {
        //             positiveComment += ' 또한, ';
        //         }

        //         positiveComment += `<strong>합리성</strong> 점수가 ${rationalityScore}%로 꽤 높은 편이에요. 논리적인 설득이 가능할지도 모르겠네요.`;
        //     }

        //     if (!positiveComment) {
        //         const defaultPositives = [
        //             '음... 긍정적인 면을 찾기가 쉽지 않네요. 하지만 이직 시장이 활발하다고 하니 희망을 가져보세요.',
        //             '매우 힘든 상황이지만, 이런 상사 밑에서 버틴다면 어디서든 살아남을 수 있을 거예요!',
        //             '최소한 당신은 상사의 문제점을 정확히 파악했어요. 이제 대응 전략을 세울 차례입니다.',
        //             '지금은 힘들지만, 나중에 당신이 관리자가 됐을 때 어떻게 하지 말아야 할지 좋은 교훈이 될 거예요.'
        //         ];

        //         positiveComment = defaultPositives[Math.floor(Math.random() * defaultPositives.length)];
        //     }

        //     positiveText.innerHTML = positiveComment;
        // }

        // 개선된 난이도 표시 함수
        function setDifficultyLevel(level) {
            // 별점 표시
            const fullStars = Math.floor(level);
            const hasHalfStar = level % 1 >= 0.5;

            for (let i = 1; i <= 5; i++) {
                const star = document.getElementById(`star-${i}`);

                if (i <= fullStars) {
                    star.classList.add('filled');
                } else if (i === fullStars + 1 && hasHalfStar) {
                    star.innerHTML = '★';
                    star.style.background = 'linear-gradient(90deg, #ff9800 50%, #ddd 50%)';
                    star.style.webkitBackgroundClip = 'text';
                    star.style.webkitTextFillColor = 'transparent';
                }
            }

            // 게이지 퍼센트 계산
            const difficultyPercentage = (level / 5) * 100;
            const gauge = document.getElementById('difficulty-gauge');
            const label = document.getElementById('difficulty-label');

            // 난이도 텍스트 및 색상 설정
            let difficultyText, difficultyColor;

            if (level < 1.5) {
                difficultyText = "순조로움";
                difficultyColor = "#4caf50"; // 녹색
            } else if (level < 2.5) {
                difficultyText = "관리 가능";
                difficultyColor = "#8bc34a"; // 연두색
            } else if (level < 3.5) {
                difficultyText = "도전적";
                difficultyColor = "#ffc107"; // 노란색
            } else if (level < 4.5) {
                difficultyText = "고난도";
                difficultyColor = "#ff9800"; // 주황색
            } else {
                difficultyText = "극악";
                difficultyColor = "#f44336"; // 빨간색
            }

            // 게이지 색상 설정
            let gaugeColor;
            if (level < 2.5) {
                gaugeColor = `linear-gradient(90deg, #4caf50, #8bc34a)`;
            } else if (level < 4) {
                gaugeColor = `linear-gradient(90deg, #8bc34a, #ffc107, #ff9800)`;
            } else {
                gaugeColor = `linear-gradient(90deg, #ff9800, #f44336)`;
            }

            // 난이도 텍스트와 게이지 업데이트
            setTimeout(() => {
                gauge.style.width = difficultyPercentage + '%';
                gauge.style.background = gaugeColor;
                label.textContent = `${difficultyText} (${difficultyPercentage.toFixed(0)}%)`;
                label.style.color = difficultyColor;
                label.style.fontWeight = "bold";
            }, 300);

            // 난이도 텍스트도 별도로 추가
            const difficultyDescription = document.getElementById('difficulty-description');
            if (difficultyDescription) {
                difficultyDescription.textContent = getDifficultyDescription(level);
                difficultyDescription.style.color = difficultyColor;
            }
        }

        // 난이도 설명 생성 함수 추가
        function getDifficultyDescription(level) {
            if (level < 1.5) {
                return "상대적으로 대처하기 쉬운 상사입니다. 기본적인 직장 예절만 지켜도 무난히 지낼 수 있어요.";
            } else if (level < 2.5) {
                return "가끔 어려운 상황이 있지만, 적절한 대응 전략으로 충분히 관리할 수 있습니다.";
            } else if (level < 3.5) {
                return "꽤 까다로운 상사입니다. 체계적인 대응 전략과 꾸준한 자기 관리가 필요합니다.";
            } else if (level < 4.5) {
                return "매우 까다로운 상사로, 강한 인내심과 전략적 사고가 필요합니다. 동료와의 연대가 중요해요.";
            } else {
                return "최고 난이도의 상사입니다. 극도의 인내심과 철저한 자기 보호가 필요하며, 가능하다면 이직도 고려해보세요.";
            }
        }

        // 공유 기능
        function setupShareButtons() {
            // 링크 복사 버튼
            document.getElementById('copy-link-btn').addEventListener('click', () => {
                // 현재 URL에서 시드를 포함한 상태로 가져오기
                const currentUrl = window.location.href;

                // 시드가 없는 경우 추가
                let shareUrl = currentUrl;
                if (!shareUrl.includes('seed=') && window.resultSeed) {
                    const separator = shareUrl.includes('?') ? '&' : '?';
                    shareUrl = `${shareUrl}${separator}seed=${window.resultSeed}`;
                }

                navigator.clipboard.writeText(shareUrl)
                    .then(() => {
                        alert('결과 링크가 클립보드에 복사되었습니다!');
                    })
                    .catch(err => {
                        console.error('링크 복사 실패:', err);
                        // 대체 방법
                        const tempInput = document.createElement('input');
                        document.body.appendChild(tempInput);
                        tempInput.value = shareUrl;
                        tempInput.select();
                        document.execCommand('copy');
                        document.body.removeChild(tempInput);
                        alert('결과 링크가 클립보드에 복사되었습니다!');
                    });
            });

            // 공유하기 버튼 (Web Share API)
            document.getElementById('share-btn').addEventListener('click', () => {
                const bossTypeText = document.getElementById('boss-title').textContent;

                // 현재 URL에서 시드를 포함한 상태로 가져오기
                const currentUrl = window.location.href;

                // 시드가 없는 경우 추가
                let shareUrl = currentUrl;
                if (!shareUrl.includes('seed=') && window.resultSeed) {
                    const separator = shareUrl.includes('?') ? '&' : '?';
                    shareUrl = `${shareUrl}${separator}seed=${window.resultSeed}`;
                }

                const shareData = {
                    title: '미운 그놈 스탯 분석 결과 - 직장편',
                    text: `내 상사는 "${bossTypeText}"이(가) 나왔어요! 당신의 상사는 어떤 유형인가요?`,
                    url: shareUrl
                };

                if (navigator.share) {
                    navigator.share(shareData)
                        .catch(err => {
                            console.error('공유 실패:', err);
                        });
                } else {
                    alert('이 브라우저는 공유 기능을 지원하지 않습니다. 링크 복사를 이용해주세요.');
                }
            });

            // 테스트 다시하기 버튼
            document.getElementById('back-btn').addEventListener('click', () => {
                window.location.href = 'index.html';
            });
        }

        // 페이지 초기화 함수 - 한 번만 실행되도록 보장
        function initializePage() {
            // 이미 초기화된 경우 중복 실행 방지
            if (pageInitialized) return;
            pageInitialized = true;

            // URL에서 능력치 결과 가져오기
            const stats = getStatsFromURL();

            // URL에서 시드값 직접 가져오기
            const urlParams = new URLSearchParams(window.location.search);
            const seedParam = urlParams.get('seed');

            // 시드가 있으면 그것을 사용, 없으면 새로 생성
            if (seedParam && !isNaN(parseInt(seedParam))) {
                window.resultSeed = parseInt(seedParam);
            } else {
                // 새 시드 생성 (현재 시간 + 스탯 합계)
                window.resultSeed = Date.now() + Object.values(stats).reduce((sum, val) => sum + val, 0);
            }

            console.log("사용 중인 시드:", window.resultSeed);

            // 결과가 없으면 오류 메시지 표시
            if (Object.keys(stats).length === 0) {
                document.getElementById('boss-title').textContent = '결과를 불러올 수 없습니다';
                document.getElementById('boss-description').innerHTML = '<p>테스트를 처음부터 다시 진행해주세요.</p>';
                return;
            }

            try {
                // 레이더 차트 생성
                createRadarChart(stats);

                // 상사 유형 분석
                const bossAnalysis = analyzeBossType(stats);
                console.log("보스 분석 결과:", bossAnalysis); // 디버깅용

                // 상사 유형 표시
                document.getElementById('boss-title').textContent = bossAnalysis.title;

                // 상사 설명 표시
                displayBossDescription(bossAnalysis.title);

                // 상사 이미지 설정
                setBossImage(bossAnalysis.title);

                // 말풍선 내용 설정 (오류 처리 추가)
                if (bossAnalysis.topStats && bossAnalysis.topStats.length > 0) {
                    try {
                        setRandomBubbles(bossAnalysis.topStats);
                    } catch (error) {
                        console.error("말풍선 설정 오류:", error);
                    }
                }

                // 난이도 설정
                setDifficultyLevel(bossAnalysis.difficultyLevel);

                // 생존 팁 생성 (오류 처리 추가)
                if (bossAnalysis.topStats && bossAnalysis.topStats.length > 0) {
                    try {
                        generateSurvivalTips(bossAnalysis.topStats);
                    } catch (error) {
                        console.error("빡침 포인트 생성 오류:", error);
                        // 오류 발생 시 기본 내용 표시
                        const tipsList = document.getElementById('tips-list');
                        if (tipsList) {
                            tipsList.innerHTML = '<li>상사와의 갈등 상황에서 심호흡하고 감정을 진정시키세요.</li>' +
                                '<li>동료들과 함께 어려움을 나누며 지지를 구하세요.</li>' +
                                '<li>업무 외 취미나 운동으로 스트레스를 해소하는 시간을 가지세요.</li>';
                        }
                    }
                }

                // 공유 버튼 설정
                setupShareButtons();
            } catch (error) {
                console.error("결과 초기화 중 오류 발생:", error);
                // 오류 시 기본 메시지 표시
                document.getElementById('boss-title').textContent = '결과 로딩 중 오류가 발생했습니다';
                document.getElementById('boss-description').innerHTML = '<p>페이지를 새로고침하거나 다시 시도해주세요.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            // 로딩 메시지 배열
            const loadingMessages = [
                "상사의 꼰대력을 측정중...",
                "내로남불 지수 분석중...",
                "갑질 패턴 탐색중...",
                "워라밸 파괴력 계산중...",
                "책임회피 사례 수집중...",
                "이중인격 지표 분석중...",
                "상사의 영혼을 검색중...",
                "압박관리 스타일 분석중...",
                "퇴사 가능성 예측중..."
            ];

            // 결과 컨테이너 숨기기
            const resultContainer = document.querySelector('.result-container');
            if (resultContainer) {
                resultContainer.style.display = 'none';
            }

            // 로딩 화면 표시
            const loadingContainer = document.getElementById('loading-container');
            const progressBar = document.getElementById('loading-progress-bar');
            const percentage = document.getElementById('loading-percentage');
            const loadingMessage = document.getElementById('loading-message');
            const showResultsBtn = document.getElementById('show-results-btn');

            // URL에서 시드 확인
            const urlParams = new URLSearchParams(window.location.search);
            const hasSeed = urlParams.has('seed');

            // 시드 유무에 따라 로딩 시간 결정
            // 이미 분석된 결과를 보는 경우(시드 있음) 짧은 로딩 시간 적용
            const randomLoadingTime = hasSeed
                ? Math.floor(Math.random() * (2000 - 1000 + 1)) + 1000  // 1~2초
                : Math.floor(Math.random() * (7000 - 4000 + 1)) + 4000; // 4~7초

            let currentProgress = 0;

            // 메시지 변경 간격 (시드 유무에 따라 간격 조정)
            const messageChangeInterval = randomLoadingTime / (loadingMessages.length + 1);
            let currentMessageIndex = 0;

            // 진행 상태 업데이트 간격
            const updateInterval = 30; // 30ms마다 업데이트
            const totalSteps = randomLoadingTime / updateInterval;
            const incrementPerStep = 100 / totalSteps;

            // 진행 상태 및 메시지 업데이트 함수
            const loadingInterval = setInterval(function () {
                currentProgress += incrementPerStep;

                if (currentProgress >= 100) {
                    currentProgress = 100;
                    clearInterval(loadingInterval);

                    // 로딩 완료 후 결과 버튼 표시
                    showResultsBtn.style.display = 'inline-block';
                    showResultsBtn.classList.add('pulse');

                    // 마지막 메시지 표시
                    loadingMessage.textContent = "분석 완료! 결과를 확인해보세요.";
                }

                // 프로그레스 바 및 퍼센트 업데이트
                progressBar.style.width = currentProgress + '%';
                percentage.textContent = Math.round(currentProgress) + '%';

                // 메시지 업데이트
                if (currentProgress > (currentMessageIndex + 1) * (100 / loadingMessages.length)) {
                    currentMessageIndex = Math.min(currentMessageIndex + 1, loadingMessages.length - 1);
                    loadingMessage.textContent = loadingMessages[currentMessageIndex];
                }
            }, updateInterval);

            // 결과 보기 버튼 클릭 이벤트
            showResultsBtn.addEventListener('click', function () {
                // 로딩 화면 숨기기
                loadingContainer.style.display = 'none';

                // 결과 컨테이너 표시
                if (resultContainer) {
                    resultContainer.style.display = 'block';

                    // 차트 다시 그리기 (필요한 경우)
                    if (typeof initializePage === 'function') {
                        initializePage();
                    }
                }
            });
        });

        // 페이지 완전 로드 시에도 초기화 시도 (DOMContentLoaded가 실패한 경우 백업)
        window.addEventListener('load', function () {
            // 아직 초기화되지 않았으면 초기화
            if (!pageInitialized) {
                console.log("DOMContentLoaded에서 초기화되지 않음, 페이지 로드에서 다시 시도");
                initializePage();
            }
        });

        // 로딩 화면 및 광고 관련 스크립트
        document.addEventListener('DOMContentLoaded', function () {
            // 로딩 메시지 배열
            const loadingMessages = [
                "상사의 꼰대력을 측정중...",
                "내로남불 지수 분석중...",
                "갑질 패턴 탐색중...",
                "워라밸 파괴력 계산중...",
                "책임회피 사례 수집중...",
                "이중인격 지표 분석중...",
                "상사의 영혼을 검색중...",
                "압박관리 스타일 분석중...",
                "퇴사 가능성 예측중..."
            ];

            // 결과 컨테이너 숨기기
            const resultContainer = document.querySelector('.result-container');
            if (resultContainer) {
                resultContainer.style.display = 'none';
            }

            // 로딩 화면 표시
            const loadingContainer = document.getElementById('loading-container');
            const progressBar = document.getElementById('loading-progress-bar');
            const percentage = document.getElementById('loading-percentage');
            const loadingMessage = document.getElementById('loading-message');
            const showResultsBtn = document.getElementById('show-results-btn');

            // 랜덤 로딩 시간 (4~7초)
            const randomLoadingTime = Math.floor(Math.random() * (7000 - 4000 + 1)) + 4000;
            let currentProgress = 0;

            // 메시지 변경 간격
            const messageChangeInterval = randomLoadingTime / (loadingMessages.length + 1);
            let currentMessageIndex = 0;

            // 진행 상태 업데이트 간격
            const updateInterval = 30; // 30ms마다 업데이트
            const totalSteps = randomLoadingTime / updateInterval;
            const incrementPerStep = 100 / totalSteps;

            // 진행 상태 및 메시지 업데이트 함수
            const loadingInterval = setInterval(function () {
                currentProgress += incrementPerStep;

                if (currentProgress >= 100) {
                    currentProgress = 100;
                    clearInterval(loadingInterval);

                    // 로딩 완료 후 결과 버튼 표시
                    showResultsBtn.style.display = 'inline-block';
                    showResultsBtn.classList.add('pulse');

                    // 마지막 메시지 표시
                    loadingMessage.textContent = "분석 완료! 결과를 확인해보세요.";
                }

                // 프로그레스 바 및 퍼센트 업데이트
                progressBar.style.width = currentProgress + '%';
                percentage.textContent = Math.round(currentProgress) + '%';

                // 메시지 업데이트
                if (currentProgress > (currentMessageIndex + 1) * (100 / loadingMessages.length)) {
                    currentMessageIndex = Math.min(currentMessageIndex + 1, loadingMessages.length - 1);
                    loadingMessage.textContent = loadingMessages[currentMessageIndex];
                }
            }, updateInterval);

            // 결과 보기 버튼 클릭 이벤트
            showResultsBtn.addEventListener('click', function () {
                // 로딩 화면 숨기기
                loadingContainer.style.display = 'none';

                // 결과 컨테이너 표시
                if (resultContainer) {
                    resultContainer.style.display = 'block';

                    // 차트 다시 그리기 (필요한 경우)
                    if (typeof initializePage === 'function') {
                        initializePage();
                    }
                }
            });
        });
    </script>
</body>

</html>
